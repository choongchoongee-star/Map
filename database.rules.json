{
  "rules": {
    "shared_sessions": {
      "session_001": {
        "places": {
          ".read": true,
          "$place_id": {
            ".write": "newData.exists()",
            ".validate": "newData.hasChildren(['name', 'address', 'location'])"
          }
        },
        "likes": {
          ".read": true,
          ".write": true
        }
      },
      "$shared_id": {
        ".read": true,
        // Only creator can delete the whole session object (null write)
        // Participants can only write to their members entry (via users/ rules) or add places
        ".write": "auth != null && (!data.exists() || data.child('metadata/creator').val() == auth.uid || (data.exists() && newData.exists() && data.child('members').child(auth.uid).exists()))",
        "places": {
          ".write": "auth != null && root.child('shared_sessions').child($shared_id).child('members').child(auth.uid).exists()"
        },
        "members": {
          "$uid": {
            ".write": "auth != null && (auth.uid == $uid || data.parent().parent().child('metadata/creator').val() == auth.uid)"
          }
        }
      }
    },
    "user_sessions": {
      "$private_id": {
        ".read": true,
        ".write": "auth != null && $private_id == 'private_' + auth.uid"
      }
    },
    "users": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    }
  }
}
