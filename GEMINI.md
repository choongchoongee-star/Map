# 🥕 당무 지도 (Dangmoo Map) - 프로젝트 상세 기획서

## 1. 프로젝트 개요 (Project Overview)
**당무 지도**는 친구나 팀원들이 맛집 정보를 실시간으로 공유하고 공동으로 관리할 수 있는 **실시간 협업 웹 맵 서비스**입니다.

- **목적:** 소규모 그룹(10인 미만)의 모임 장소 선정 및 맛집 리스트 공유 최적화.
- **핵심 가치:** 실시간 동기화, 사용자 친화적인 검색 인터페이스, 다양한 필터링/정렬 옵션.

---

## 2. 기술 스택 (Technical Stack)

### Frontend
- **Framework & Libraries:** Vanilla JavaScript (ES6+), HTML5, CSS3.
- **Maps API:** Naver Maps JS API V3 (Geocoder 서비스 포함).
- **Backend SDK:** Firebase Web SDK (v10.8.0 - Compat) - 실시간 DB 연동.

### Backend (Serverless)
- **Functions:** Firebase Cloud Functions v2 (Node.js 20 runtime).
- **Search API Proxy:** Naver Local Search API 연동 (CORS 우회 및 보안 강화).
- **Database:** Firebase Realtime Database (RTDB).

---

## 3. 기능 명세 (Feature Specifications)

### 3.1. 사용자 인증 및 다중 세션 관리
- **구글 로그인:** Firebase Auth를 통한 사용자 인증.
- **다중 세션 지원:** 
  - **전체 공유 리스트:** 누구나 보고 추가/좋아요 가능 (삭제 불가).
  - **개인 리스트:** 로그인 사용자 전용 저장소. (필요 시 코드로 친구와 공유 가능)
  - **공유 세션:** 특정 그룹끼리만 공유하는 실시간 협업 리스트.
- **게스트 참여 모드:** 비로그인 상태에서도 초대 코드를 통해 공유 리스트에 참여 가능.
  - 게스트는 목록 **조회만 가능**하며, 항목 추가 및 좋아요는 제한됨 (전체 공유 리스트 제외).
- **세션 관리 도구 (⚙️):** 
  - 소유하거나 참여 중인(게스트 포함) 모든 목록 확인.
  - 초대 코드 복사 및 공유, 목록 삭제 기능.
  - **제한사항:** 새 목록 생성은 로그인 사용자만 가능.
- **세션 스위처:** 사이드바에서 활성 세션을 즉시 전환하여 각기 다른 리스트 확인 가능.

### 3.2. 실시간 장소 공유 및 관리
- **실시간 동기화:** Firebase RTDB의 이벤트를 통해 장소 추가, 삭제, 좋아요 업데이트 시 모든 접속자에게 즉각 반영.
- **상태 관리:** 세션 전환 시 기존 리스너 해제 및 데이터 초기화 로직 포함.

### 3.3. 스마트 검색 및 대량 추가
- **Naver Search 연동:** Cloud Functions을 통한 안전한 API 호출 및 결과 파싱.
- **내 리스트로 저장:** 다른 세션의 장소를 클릭 한 번으로 내 개인 리스트로 복사하는 기능.
- **대량 장소 추가 (Batch Add):** 텍스트 리스트를 붙여넣어 대량의 장소를 자동으로 검색하고 추가하는 기능 (API 보호를 위한 지연 로직 포함).
- **Geocoding:** 주소 텍스트를 위/경도 좌표로 변환하여 지도 위 마커 생성.
- **검색 필터링:** 불필요한 HTML 태그 제거 및 데이터 정제 후 사용자에게 제공.

### 3.4. 사이드바 및 리스트 제어
- **페이지네이션:** 쾌적한 UX를 위해 사이드바 목록을 10개 단위로 페이징.
- **카테고리 필터링:** 등록된 장소들의 카테고리를 자동으로 추출하여 특정 카테고리만 모아볼 수 있는 기능.
- **삭제 권한 제어:** 전체 공유 리스트(`session_001`)의 데이터는 삭제가 불가능하며, 개인 세션의 데이터만 삭제 가능.
- **스마트 정렬:** 
  - **최신순:** 가장 최근에 등록된 장소를 상단에 노출.
  - **좋아요순:** 다른 사용자들에게 인기가 많은 순서로 정렬.
  - **거리순:** 현재 지도 중심점(Viewport Center)에서 가까운 순서로 정렬 (Haversine 공식 적용).
- **범위 필터링 (Bounds Filter):** 현재 지도의 보이는 영역 안에 있는 장소만 리스트에 필터링하여 표시하는 기능.

### 3.4. 소셜 상호작용 (Social Features)
- **좋아요 기능:** 하트 버튼 클릭 시 사용자별 좋아요 상태 기록.
- **실시간 카운트:** 좋아요 수의 변화가 실시간으로 모든 사용자에게 시각화됨.

### 3.5. 딥 링크 및 초대 시스템
- **App Handoff:** 모바일 브라우저에서 네이버 지도 앱으로 자동 전환.
- **초대 링크 공유:** 세션별 고유 URL을 생성하여 즉시 리스트에 참여 가능.

### 3.6. 반응형 UI 디자인
- **PC 레이아웃:** 좌측 고정 사이드바와 넓은 지도 뷰 제공.
- **모바일 UX 최적화:** 
  - **바텀 시트(Bottom Sheet):** 사이드바 대신 화면 하단에서 위로 올라오는 리스트 뷰를 적용하여 지도 가독성 확보.
  - **목록 보기 버튼(FAB):** 리스트가 닫혀 있을 때 화면 하단 중앙에 플로팅 버튼을 제공하여 접근성 향상.
  - **헤더 슬림화:** 모바일 화면 공간 확보를 위해 헤더 디자인 간소화 및 햄버거 메뉴 적용.
  - **인터랙션:** 지도 클릭 시 바텀 시트 자동 닫힘 기능으로 지도 중심의 경험 강화.

---

## 4. 데이터 아키텍처 (Data Architecture)

### 4.1. 데이터베이스 스키마 (Firebase RTDB)
```json
{
  "shared_sessions": {
    "session_001": {
      "metadata": { "title": "모임 이름", "created_at": 123456789 },
      "places": {
        "PLACE_UNIQUE_ID": {
          "name": "식당 명칭",
          "address": "도로명/지번 주소",
          "category": "음식점 > 카페",
          "location": { "lat": 37.56, "lng": 126.97 },
          "naver_url": "https://map.naver.com/v5/search/...",
          "added_by": "User_456",
          "likes": {
            "User_ID": true
          }
        }
      }
    }
  }
}
```

---

## 5. 환경 설정 및 인증 (Credentials & Config)
- **Naver Client ID:** `3rh84i5w65` (Maps API용)
- **Firebase Project:** `dangmoo-map`
- **주요 설정 파일:** 
  - `js/firebase-config.js` (클라이언트 SDK 설정)
  - `functions/index.js` (서버사이드 API Key 관리)

---

## 6. 보안 및 최적화 전략 (Security & Optimization)

- **호스팅 환경 최적화:** GitHub Pages 대신 **Firebase Hosting**을 사용하여 보안 헤더(CSP, HSTS, X-Frame-Options)를 적용하고 SPA 라우팅을 최적화.
- **서버사이드 보안 규칙 (Security Rules):** 
  - `database.rules.json`을 통해 데이터 무결성 및 권한 제어.
  - **전체 공유 리스트:** 누구나 추가 및 좋아요가 가능하지만, 삭제(`null` 쓰기)는 서버 단에서 차단.
  - **개인/공유 리스트:** 초대 코드가 있으면 누구나 **조회(Read)** 가능하도록 하여 비로그인 참여 지원.
  - **쓰기 권한:** 개인 리스트는 소유자만, 공유 세션은 등록된 멤버만 가능하도록 제한.
- **비용 제어 전략:** 
  - **Spark 플랜(무료) 유지:** 할당량 초과 시 비용 청구 대신 서비스 자동 중단(Safety Net).
  - **Google Cloud 예산 알림:** 특정 금액 도달 시 관리자에게 즉시 알림 발송 설정.
- **성능 최적화:** 지도 경계 변경 시 필터링 로직에 디바운스 적용, 거리 계산 시 지도 중심점이 바뀔 때만 재정렬 수행.

---

## 7. 개발 로드맵 (Roadmap)

### Phase 3: 기능 확장 및 수익화 기반 (진행중)
- [x] 사용자 인증 및 개인 세션 기능 (완료)
- [x] 개별 모임방(Session) 생성 및 친구 초대 기능 (완료)
- [x] 초대 링크(URL) 기반 자동 참여 기능 (완료)
- [x] 기존 개인 세션 공유 및 목록 관리 기능 (완료)
- [x] 생성자 기반 세션 삭제 및 참여 취소 권한 제어 (완료)
- [x] 비로그인 게스트 세션 참여 기능 (조회 전용) (완료)
- [x] 장소 복사 및 대상 목록 선택 저장 기능 (완료)
- [x] 저장 여부 시각화 (컬러 북마크 아이콘) (완료)
- [x] 보안 강화 (Firebase Hosting 및 Security Rules 적용) (완료)
- [x] 대량 장소 추가 (Batch Add) 기능 (완료)
- [x] 중복 장소 추가 방지 로직 (완료)

### Phase 4: 비즈니스 고도화 및 최적화 (예정)
- [ ] 스폰서 스팟 노출: 리스트 최상단 '연인들이 선호하는 주변 스팟' 등 타겟 광고 구좌.
- [ ] 기술적 비용 최적화 (Caching Layer): API 중복 호출 방지를 위한 Redis 및 로컬 스토리지 캐싱.
- [ ] 정적 지도(Static Maps) 도입: 인터랙션 불필요 구간의 이미지 맵 대체로 비용 절감.
- [ ] 앱 설치 유도형 스마트 딥링크 (Store 연동).
- [ ] 카테고리별 마커 커스텀 아이콘.
- [ ] 장소별 그룹 채팅 또는 메모 기능.
